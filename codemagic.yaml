workflows:
  flutter_build:
    name: Flutter Build
    max_build_duration: 60 # Optional: Limit the build duration (in minutes)
    environment:
      flutter: stable  # Use stable Flutter SDK
      vars:
        - name: API_KEY
          value: ${{ secrets.API_KEY }}  # Secret OpenAI API key
        - name: FLUTTER_BUILD_MODE
          value: release  # Build mode (release or debug)

    # Steps to install dependencies, clean the project, and build APK
    steps:
      - name: Install dependencies
        run: flutter pub get
      - name: Clean the project
        run: flutter clean
      - name: Build APK
        run: flutter build apk --release

    android:
      build:
        script:
          - flutter pub get  # Fetch dependencies
          - flutter clean  # Clean the project to avoid caching issues
          - flutter build apk --release  # Build APK in release mode

        signing:
          keystore:
            file: ${{ secrets.KEYSTORE_FILE }}  # Keystore file uploaded in Codemagic secrets
            password: ${{ secrets.KEYSTORE_PASSWORD }}  # Keystore password
            alias: ${{ secrets.KEY_ALIAS }}  # Alias for the key inside the keystore
            key_password: ${{ secrets.KEY_PASSWORD }}  # Key password for the alias inside the keystore

    artifacts:
      - build/app/outputs/flutter-apk/app-release.apk  # Path to the output APK file

